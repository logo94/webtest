<!DOCTYPE html>
<html>
<head>
  <title>Test Fetch</title>
</head>
<body>


  <script>

    // Funzione per inviare il messaggio a content.js
function callApiThroughExtension(apiUrl) {
    return new Promise((resolve, reject) => {
        // Crea un ID per la richiesta
        const requestId = Date.now();

        // Funzione per ricevere la risposta da content.js
        window.addEventListener('message', function handleMessage(event) {
            // Assicurati che il messaggio arrivi dal content script
            if (event.origin !== window.origin || !event.data || event.data.requestId !== requestId) {
                return;
            }

            // Gestisci la risposta
            if (event.data.success) {
                resolve(event.data.data);
            } else {
                reject(event.data.error);
            }

            // Rimuovi l'event listener per evitare che venga eseguito piÃ¹ volte
            window.removeEventListener('message', handleMessage);
        });

        // Invia il messaggio a content.js con l'URL dell'API
        window.postMessage({ action: 'request-api', url: apiUrl, requestId: requestId }, window.origin);
    });
}

// Esempio di utilizzo nella pagina web
callApiThroughExtension('https://www.wikidata.org/w/api.php?action=query&meta=tokens&format=json')
    .then(data => {
        console.log('Dati ricevuti:', data);
    })
    .catch(error => {
        console.error('Errore nella chiamata API:', error);
    });


    
  </script>
</body>
</html>

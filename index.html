<!DOCTYPE html>
<html>
<head>
  <title>Test Fetch</title>
</head>
<body>

  <input type="text" id="api-url" placeholder="Inserisci l'URL API">
  <button id="call-api-btn">Fai richiesta API</button>

  <script>
    // Gestisci il click del bottone per inviare la richiesta
    document.getElementById('call-api-btn').addEventListener('click', function() {
        const url = document.getElementById('api-url').value;  // Ottieni l'URL dall'input
        if (url) {
            const requestId = new Date().getTime();  // Crea un ID univoco per tracciare la risposta

            // Invia il messaggio alla pagina per richiedere l'API tramite content.js
            window.postMessage({
                action: 'request-api',
                url: url,
                requestId: requestId
            }, window.origin);

            // Ascolta la risposta dal content.js
            window.addEventListener('message', function(event) {
                // Verifica che la risposta sia corretta (stessa origine, azione corretta, ID corretto)
                if (event.origin !== window.origin || !event.data || event.data.action !== 'api-response' || event.data.requestId !== requestId) {
                    return; // Ignora risposte non correlate
                }

                // Gestisci la risposta (successo o errore)
                if (event.data.success) {
                    console.log('Risultato API:', event.data.data);
                } else {
                    console.error('Errore API:', event.data.error);
                }
            });
        } else {
            console.log('URL non valido');
        }
    });
  </script>

</body>
</html>
